; supervisord.conf
[supervisord]
nodaemon=true
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid
childlogdir=/var/log/supervisor

[program:nginx]
command=/usr/sbin/nginx -g "daemon off;"
autostart=true
autorestart=true
startretries=5
stdout_logfile=/var/log/nginx/supervisor-stdout.log
stderr_logfile=/var/log/nginx/supervisor-stderr.log

[program:worker1]
command=node /app/server/worker.js
environment=WORKER_ID="1",WORKER_PORT="3001",NODE_ENV="production",BASE_UPLOAD_DIR="/app/uploads"
autostart=true
autorestart=true
startretries=5
stdout_logfile=/var/log/worker1.log
stderr_logfile=/var/log/worker1-error.log

[program:worker2]
command=node /app/server/worker.js
environment=WORKER_ID="2",WORKER_PORT="3002",NODE_ENV="production",BASE_UPLOAD_DIR="/app/uploads"
autostart=true
autorestart=true
startretries=5
stdout_logfile=/var/log/worker2.log
stderr_logfile=/var/log/worker2-error.log

[program:worker3]
command=node /app/server/worker.js
environment=WORKER_ID="3",WORKER_PORT="3003",NODE_ENV="production",BASE_UPLOAD_DIR="/app/uploads"
autostart=true
autorestart=true
startretries=5
stdout_logfile=/var/log/worker3.log
stderr_logfile=/var/log/worker3-error.log

[program:worker4]
command=node /app/server/worker.js
environment=WORKER_ID="4",WORKER_PORT="3004",NODE_ENV="production",BASE_UPLOAD_DIR="/app/uploads"
autostart=true
autorestart=true
startretries=5
stdout_logfile=/var/log/worker4.log
stderr_logfile=/var/log/worker4-error.log

[group:ai-chat]
programs=worker1,worker2,worker3,worker4